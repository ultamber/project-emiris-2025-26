#  **README –  Ανάπτυξη Λογισμικού για Αλγοριθμικά Προβλήματα**
Χειμερινό εξάμηνο 2025-26

1η Προγραμματιστική Εργασία

Αναζήτηση διανυσμάτων στη C/C++

**Συγγραφείς:**
**Ονοματεπώνυμο:** Μαρκοπούλου Χριστίνα ,Βασταρδής Νικόλαος

**Αριθμός Μητρώου:** 1115201800109  ,1115201900020 

## **α) Περιγραφή**

Το παρόν project υλοποιεί και συγκρίνει διαφορετικές μεθόδους **Αναζήτησης Πλησιέστερων Γειτόνων (Nearest Neighbor Search)**, με στόχο την αποδοτική αναζήτηση σε μεγάλα, υψηλής διάστασης σύνολα δεδομένων.  
Πρόκειται για εφαρμογή που υποστηρίζει τόσο **προσεγγιστικούς** όσο και **ακριβείς** αλγορίθμους αναζήτησης.

Κάθε αλγόριθμος δομεί ένα ευρετήριο πάνω στο σύνολο εκπαίδευσης (`dataset`) και στη συνέχεια αναζητά για κάθε διάνυσμα ερωτήματος (`query`) τους πλησιέστερους γείτονες βάσει της ευκλείδειας απόστασης (L2).

Υποστηριζόμενες μέθοδοι:
-  **Brute Force Search (ακριβής)**
-  **Locality Sensitive Hashing (LSH)**
-  **Hypercube Hashing**
-  **IVF-Flat (Inverted File Index με K-means)**
-  **IVF-PQ (Product Quantization)**

---

## **β) Κατάλογος Αρχείων Κώδικα και Περιγραφή**

| Αρχείο | Περιγραφή |
|--------|------------|
| **`main.cpp`** | Κύριο πρόγραμμα. Διαβάζει ορίσματα γραμμής εντολών, φορτώνει δεδομένα, επιλέγει αλγόριθμο και γράφει αποτελέσματα σε αρχείο εξόδου. |
| **`arguments.hpp`** | Ορισμός της δομής `Arguments`, η οποία αποθηκεύει όλες τις παραμέτρους εκτέλεσης. |
| **`dataset.hpp`** | Υλοποίηση της κλάσης `Dataset`, η οποία φορτώνει δεδομένα και αποθηκεύει διανύσματα εισόδου (id, dimension, values). |
| **`lsh.cpp` / `lsh.hpp`** | Υλοποίηση του αλγορίθμου **Locality Sensitive Hashing (LSH)**, βασισμένου σε προβολές τύπου p-stable για L2. |
| **`hypercube.cpp` / `hypercube.hpp`** | Υλοποίηση του **Hypercube**: προβάλλει τα διανύσματα σε k-διάστατο δυαδικό κύβο και κάνει αναζήτηση με Hamming απόσταση και περιορισμένα probes. |
| **`ivfflat.cpp` / `ivfflat.hpp`** | Υλοποίηση του **IVFFlat**, που βασίζεται σε K-means clustering για ομαδοποίηση των διανυσμάτων σε λίστες (inverted lists). |
| **`ivfpq.cpp` / `ivfpq.hpp`** | Υλοποίηση του **IVFPQ**, που συνδυάζει IVF με **Product Quantization** για περαιτέρω συμπίεση και ταχύτερη αναζήτηση. |
| **`bruteforce.cpp` / `bruteforce.hpp`** | Ακριβής μέθοδος αναζήτησης. Υπολογίζει εξαντλητικά όλες τις αποστάσεις L2. |
| **`utils.cpp`** | Περιέχει βοηθητικές συναρτήσεις για ευκλείδειες αποστάσεις και αναζήτηση. |
| **`search_method.hpp`** | Ενιαίο interface/abstract class για όλες τις μεθόδους αναζήτησης. |
| **`Makefile`** | Αυτοματοποιεί τη μεταγλώττιση όλων των αρχείων. |

---

## **γ) Οδηγίες Μεταγλώττισης**

Απαιτείται μεταγλωττιστής **g++**  με υποστήριξη **C++17** ή νεότερης.

### **Με απευθείας εντολή:**
```bash
g++ -std=c++17 -O2 -o search main.cpp lsh.cpp hypercube.cpp ivfflat.cpp ivfpq.cpp bruteforce.cpp utils.cpp
```

### **Προαιρετικά με Makefile:**
Εκτελέστε:
```bash
make
```

Το παραγόμενο εκτελέσιμο είναι το **`search`** στον φάκελο bin.

---

## **δ) Οδηγίες Χρήσης**

Η γενική μορφή εντολής είναι:

```bash
./search -d <dataset_file> -q <query_file> -o <output_file> -type <dataset_type> [επιλογή_αλγορίθμου] [παράμετροι]
```

### **Επιλογή Αλγορίθμου**
Μόνο μία επιλογή ανά εκτέλεση:
- `-lsh` : Εκτέλεση LSH  
- `-hypercube` : Εκτέλεση Hypercube  
- `-ivfflat` : Εκτέλεση IVF-Flat  
- `-ivfpq` : Εκτέλεση IVF-PQ  
- *(Αν δεν δοθεί κάποια από αυτές, εμφανίζεται μήνυμα λάθους)*

---

### **Κοινές Παράμετροι**

| Παράμετρος | Περιγραφή |
|-------------|------------|
| `-d <file>` | Αρχείο dataset με διανύσματα εκπαίδευσης |
| `-q <file>` | Αρχείο με query διανύσματα |
| `-o <file>` | Αρχείο εξόδου αποτελεσμάτων |
| `-type <string>` | Τύπος dataset (`mnist`, `sift`) |
| `-N <int>` | Αριθμός γειτόνων που θα αναζητηθούν |
| `-R <float>` | Ακτίνα για range search |
| `-range <true/false>` | Ενεργοποίηση range search |
| `-seed <int>` | Τυχαίο seed για αναπαραγωγιμότητα |

---

### **Εξειδικευμένες Παράμετροι Ανά Αλγόριθμο**

#### 🔹 LSH
| Παράμετρος | Περιγραφή |
|-------------|------------|
| `-L <int>` | Πλήθος hash tables |
| `-k <int>` | Πλήθος hash functions ανά table |
| `-w <float>` | Πλάτος “window” για quantization |

#### 🔹 Hypercube
| Παράμετρος | Περιγραφή |
|-------------|------------|
| `-kproj <int>` | Διαστάσεις προβολής (bits του cube) |
| `-M <int>` | Μέγιστος αριθμός υποψηφίων |
| `-probes <int>` | Πλήθος κορυφών του κύβου που εξετάζονται |

#### 🔹 IVF-Flat
| Παράμετρος | Περιγραφή |
|-------------|------------|
| `-kclusters <int>` | Πλήθος κέντρων K-means |
| `-nprobe <int>` | Πλήθος κοντινών clusters που θα εξεταστούν |

#### 🔹 IVF-PQ
| Παράμετρος | Περιγραφή |
|-------------|------------|
| `-kclusters <int>` | Πλήθος κέντρων IVF |
| `-nprobe <int>` | Πλήθος clusters για αναζήτηση |
| `-nbits <int>` | Πλήθος bits ανά υπο-κωδικοποιητή |
| `-Msub <int>` | Πλήθος υποδιανυσμάτων (subvectors) για PQ |

---

### **Παράδειγμα Εκτέλεσης**

#### LSH
```bash
./bin/search -d ./datasets/MNIST/train-images.idx3-ubyte -q ./datasets/MNIST/t10k-images.idx3-ubyte -o out_lsh.txt -type mnist -lsh -L 5 -k 4 -w 300 -N 2 -R 10000 -range true
```

#### Hypercube
```bash
./bin/search -d ./datasets/MNIST/train-images.idx3-ubyte -q ./datasets/MNIST/t10k-images.idx3-ubyte -o out_cube.txt -type mnist -hypercube -kproj 14 -M 10 -probes 3
```

#### IVF-Flat
```bash
./bin/search -d ./datasets/MNIST/train-images.idx3-ubyte -q ./datasets/MNIST/t10k-images.idx3-ubyte -o out_ivfflat.txt -type mnist -ivfflat -kclusters 50 -nprobe 3
```

#### IVF-PQ
```bash
./bin/search -d ./datasets/MNIST/train-images.idx3-ubyte -q ./datasets/MNIST/t10k-images.idx3-ubyte -o out_ivfpq.txt -type mnist -ivfpq -kclusters 100 -nprobe 5 -nbits 8 -Msub 4
```

---

## **ε) Μορφή Εξόδου**

Το αρχείο εξόδου περιλαμβάνει για κάθε ερώτημα:
- Πλησιέστερους γείτονες (id, απόσταση προσεγγιστική και πραγματική)
- Λίστα “R-near neighbors”
- Τελικές μετρικές απόδοσης ανά ερώτημα και συνολικά

Παράδειγμα αποσπάσματος:
```
Query: 0
Nearest neighbor-1: 532
distanceApproximate: 812.543213
distanceTrue: 812.543213
R-near neighbors:
532
812
...

---- Summary (averages over queries) ----
Average AF: 1.034215
Recall@N: 0.92
QPS: 34.551299
tApproximateAverage: 0.027441
tTrueAverage: 0.314209
```

---

## **στ) Εσωτερική Αρχιτεκτονική**

Η εφαρμογή ακολουθεί modular σχεδίαση:
1. **`Arguments`**: χειρίζεται όλες τις παραμέτρους εκτέλεσης.
2. **`Dataset`**: διαχειρίζεται τη φόρτωση και αποθήκευση δεδομένων.
3. **`SearchMethod`**: αφηρημένη διεπαφή που υλοποιείται από κάθε αλγόριθμο.
4. **`main.cpp`**: δημιουργεί το κατάλληλο αντικείμενο αλγορίθμου, το εκπαιδεύει (buildIndex) και εκτελεί αναζήτηση (search).

Η κλάση κάθε αλγορίθμου παρέχει δύο βασικές συναρτήσεις:
```cpp
void buildIndex(const Dataset& data);
void search(const Dataset& queries, std::ofstream& out);
```
